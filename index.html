<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CrickScore</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="https://img.icons8.com/color/96/cricket.png" type="image/png" />
  <meta name="theme-color" content="#4f46e5" />

  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <style>
    .input {
      border: 1px solid #ccc;
      padding: 0.4rem;
      border-radius: 0.25rem;
    }
    .btn {
      padding: 0.4rem 0.8rem;
      background: #4f46e5;
      color: white;
      border-radius: 0.25rem;
      cursor: pointer;
    }
    .btn:hover {
      background: #4338ca;
    }
    .btn:disabled {
      background: #999;
      cursor: not-allowed;
    }
    @keyframes bounceIn {
      0% { transform: scale(0.5); opacity: 0; }
      60% { transform: scale(1.2); opacity: 1; }
      100% { transform: scale(1); }
    }
    .animate-bounce-in {
      animation: bounceIn 1s ease-out forwards;
    }
  </style>
</head>
<body class="bg-white text-gray-800 font-sans p-4 max-w-xl mx-auto">
  <h1 class="text-3xl font-bold mb-4 text-center">üèè CrickScore</h1>

  <div class="space-y-4">
    <div class="flex flex-col sm:flex-row gap-4 sm:items-center">
  <label class="flex items-center gap-2">Team A: <input id="teamA" class="input" /></label>
  <label class="flex items-center gap-2">Team B: <input id="teamB" class="input" /></label>
</div>
    
    <div>
      <label>Overs: <input id="totalOvers" class="input w-20" type="number" min="1" /></label>
      <button onclick="startMatch()" class="btn ml-4">Start Match</button>
      <button onclick="clearHistory()" class="btn ml-2 bg-red-500 hover:bg-red-600">Clear History</button>
    </div>

    <div id="matchPanel" class="hidden space-y-4">
      <div class="text-lg font-semibold">üèè Match: <span id="matchTeams"></span> <span id="inningLabel">(1st Innings)</span></div>
      <div class="text-md">
        <div id="targetInfo" class="font-semibold text-green-700 mb-1"></div>
        Score: <span id="score">0/0</span><br />
        Overs: <span id="overs">0.0</span><br />
        Run Rate: <span id="runRate">0.00</span><br />
        Overs Left: <span id="oversLeft">0.0</span>
      </div>

      <div class="space-x-2">
        <button onclick="addRun(0)" class="btn">Dot</button>
        <button onclick="addRun(1)" class="btn">1</button>
        <button onclick="addRun(2)" class="btn">2</button>
        <button onclick="addRun(3)" class="btn">3</button>
        <button onclick="addRun(4)" class="btn">4</button>
        <button onclick="addRun(6)" class="btn">6</button>
        <button onclick="addWide()" class="btn bg-yellow-400">Wide</button>
        <button onclick="addLegBye()" class="btn bg-green-400">Leg Bye</button>
        <button onclick="addWicket()" class="btn bg-red-500 hover:bg-red-600">Wicket</button>
      </div>

      <div class="space-x-2 mt-4">
        <button onclick="undoLastBall()" class="btn bg-gray-400">Undo</button>
        <button onclick="endMatch()" class="btn bg-gray-600 hover:bg-gray-700">End Match</button>
      </div>
    </div>

    <div id="scoreboard" class="mt-6 hidden">
      <h2 class="text-xl font-semibold mb-2">Full Scoreboard</h2>
      <h3 class="text-lg font-semibold">Batsmen</h3>
      <table class="w-full text-sm mb-4 border">
        <thead>
          <tr class="bg-gray-100">
            <th class="border px-2">Name</th>
            <th class="border px-2">Runs</th>
            <th class="border px-2">Balls</th>
            <th class="border px-2">Dots</th>
            <th class="border px-2">4s</th>
            <th class="border px-2">6s</th>
            <th class="border px-2">Status</th>
          </tr>
        </thead>
        <tbody id="batsmanTable"></tbody>
      </table>

      <h3 class="text-lg font-semibold">Bowlers</h3>
      <table class="w-full text-sm border">
        <thead>
          <tr class="bg-gray-100">
            <th class="border px-2">Name</th>
            <th class="border px-2">Overs</th>
            <th class="border px-2">Runs</th>
            <th class="border px-2">Dots</th>
            <th class="border px-2">Wickets</th>
          </tr>
        </thead>
        <tbody id="bowlerTable"></tbody>
      </table>
    </div>

    <div id="summary" class="mt-6 hidden">
      <h3 class="font-bold text-lg mb-2">üèÅ Match Summary</h3>
      <p id="winner"></p>
      <div id="playAgainContainer" class="mt-4"></div>
    </div>

    <div id="history" class="mt-6">
      <h3 class="font-bold text-lg mb-2">üìú Past Matches</h3>
      <ul id="matchHistory" class="list-disc pl-5 space-y-1"></ul>
    </div>
  </div>

  <audio id="victorySound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-notification-2018.mp3"></audio>

  <script>
   let history = JSON.parse(localStorage.getItem('crickHistory') || '[]');
let inning = 1;
let firstInningsScore = 0;
let totalOvers = 0;

let score = 0;
let wickets = 0;
let balls = 0;
let extras = 0;
let legByeCount = 0;
let dots = 0;

let batsmen = [];
let bowlers = [];
let currentBatsmanIndex = 0;
let currentBowlerIndex = 0;
let ballHistory = [];

// Restore match state on load
window.onload = function () {
  const savedState = localStorage.getItem("crickscoreState");
  if (savedState) {
    const state = JSON.parse(savedState);
    score = state.score;
    wickets = state.wickets;
    balls = state.balls;
    totalOvers = state.totalOvers;
    legByeCount = state.legByeCount;
    batsmen = state.batsmen;
    bowlers = state.bowlers;
    currentBatsmanIndex = state.currentBatsmanIndex;
    currentBowlerIndex = state.currentBowlerIndex;
    inning = state.inning;
    firstInningsScore = state.firstInningsScore;
    extras = state.extras || 0;
    ballHistory = state.ballHistory || [];

    document.getElementById("teamA").value = state.teamA;
    document.getElementById("teamB").value = state.teamB;
    document.getElementById("totalOvers").value = state.totalOvers;

    document.getElementById("matchPanel").classList.remove("hidden");
    document.getElementById("scoreboard").classList.remove("hidden");
    document.getElementById("matchTeams").textContent = `${state.teamA} vs ${state.teamB}`;
    document.getElementById("inningLabel").textContent = `(Innings ${inning})`;
    if (inning === 2) {
      document.getElementById("targetInfo").textContent = `Target: ${firstInningsScore + 1} to win`;
    }

    updateDisplay();
    renderScoreboard();
  }
};

function saveMatchState() {
  const matchState = {
    score, wickets, balls, totalOvers, legByeCount,
    batsmen, bowlers, currentBatsmanIndex, currentBowlerIndex,
    inning, firstInningsScore, extras, ballHistory,dots
    teamA: document.getElementById("teamA").value.trim(),
    teamB: document.getElementById("teamB").value.trim()
  };
  localStorage.setItem("crickscoreState", JSON.stringify(matchState));
}

function clearMatchState() {
  localStorage.removeItem("crickscoreState");
}
    
function startMatch() {
  clearMatchState();
  const teamA = document.getElementById("teamA").value.trim();
  const teamB = document.getElementById("teamB").value.trim();
  totalOvers = parseInt(document.getElementById("totalOvers").value);

  if (!teamA || !teamB || isNaN(totalOvers) || totalOvers <= 0) {
    alert("Please enter valid team names and overs.");
    return;
  }

  inning = 1;
  firstInningsScore = 0;
  score = 0;
  wickets = 0;
  balls = 0;
  extras = 0;
  legByeCount = 0;
  ballHistory = [];

  batsmen = [];
  bowlers = [];
  currentBatsmanIndex = 0;
  currentBowlerIndex = 0;

  document.getElementById("targetInfo").textContent = "";

  let striker = prompt("Enter name of batsman:");
  if (!striker) striker = "Batsman 1";
  let bowlerName = prompt("Enter name of opening bowler:");
  if (!bowlerName) bowlerName = "Bowler 1";

  batsmen.push({name: striker, runs:0, balls:0, fours:0, sixes:0,dotBalls:0, out:false});
  bowlers.push({name: bowlerName, balls:0, runs:0,dotBalls:0, wickets:0});

  document.getElementById("matchPanel").classList.remove("hidden");
  document.getElementById("scoreboard").classList.remove("hidden");
  document.getElementById("summary").classList.add("hidden");

  document.getElementById("matchTeams").textContent = `${teamA} vs ${teamB}`;
  document.getElementById("inningLabel").textContent = `(1st Innings)`;
  updateDisplay();
  renderScoreboard();
  renderHistory();
  saveMatchState();
}

function addRun(runs) {
  if (isInningsOver()) return alert("Innings is over.");
  const striker = batsmen[currentBatsmanIndex];
  const bowler = bowlers[currentBowlerIndex];
  score += runs;
  striker.runs += runs;
  striker.balls++;
  bowler.runs += runs;
  if (runs === 4) striker.fours++;
  if (runs === 6) striker.sixes++;
  balls++;
  bowler.balls++;
  ballHistory.push({
    type: 'run',
    runs,
    strikerIndex: currentBatsmanIndex,
    bowlerIndex: currentBowlerIndex,
    wicketsBefore: wickets,
    ballsBefore: balls - 1,
    scoreBefore: score - runs,
    batsmenBefore: JSON.stringify(batsmen),
    bowlersBefore: JSON.stringify(bowlers),
    if (runs === 0) {
  striker.dotBalls++;
  bowler.dotBalls++;
}
  });
  checkOverComplete();
  updateDisplay();
  renderScoreboard();
  checkInningsEnd();
  checkTargetReached();
  saveMatchState();
  
}

function addWide() {
  if (isInningsOver()) return alert("Innings is over.");
  score++;
  extras++;
  const bowler = bowlers[currentBowlerIndex];
  bowler.runs++;
  ballHistory.push({
    type: 'wide',
    runs: 1,
    strikerIndex: currentBatsmanIndex,
    bowlerIndex: currentBowlerIndex,
    wicketsBefore: wickets,
    ballsBefore: balls,
    scoreBefore: score - 1,
    batsmenBefore: JSON.stringify(batsmen),
    bowlersBefore: JSON.stringify(bowlers),
  });
  updateDisplay();
  renderScoreboard();
  checkTargetReached();
  saveMatchState();
}

function addLegBye() {
  if (isInningsOver()) return alert("Innings is over.");
  legByeCount++;
  const bowler = bowlers[currentBowlerIndex];
  balls++;
  bowler.balls++;
  ballHistory.push({
    type: 'legbye',
    strikerIndex: currentBatsmanIndex,
    bowlerIndex: currentBowlerIndex,
    wicketsBefore: wickets,
    ballsBefore: balls - 1,
    scoreBefore: score,
    batsmenBefore: JSON.stringify(batsmen),
    bowlersBefore: JSON.stringify(bowlers),
    legByeCountBefore: legByeCount - 1
  });
  if (legByeCount >= 3) {
    const outBatsman = batsmen[currentBatsmanIndex];
    outBatsman.out = true;
    wickets++;
    legByeCount = 0;
    alert(`${outBatsman.name} is OUT after 3 leg byes!`);
    if (wickets < 10) {
      let newBatsman = prompt("Enter name of new batsman:");
      if (!newBatsman) newBatsman = `Batsman ${wickets + 1}`;
      batsmen[currentBatsmanIndex] = { name: newBatsman, runs:0, balls:0, fours:0, sixes:0, out:false };
    } else {
      alert("All out!");
    }
  }
  checkOverComplete();
  updateDisplay();
  renderScoreboard();
  checkInningsEnd();
  checkTargetReached();
  saveMatchState();
}

function addWicket() {
  if (isInningsOver()) return alert("Innings is over.");
  wickets++;
  balls++;
  bowlers[currentBowlerIndex].balls++;
  bowlers[currentBowlerIndex].wickets++;
  batsmen[currentBatsmanIndex].out = true;
  ballHistory.push({
    type: 'wicket',
    strikerIndex: currentBatsmanIndex,
    bowlerIndex: currentBowlerIndex,
    wicketsBefore: wickets - 1,
    ballsBefore: balls - 1,
    scoreBefore: score,
    batsmenBefore: JSON.stringify(batsmen),
    bowlersBefore: JSON.stringify(bowlers),
  });
  if (wickets < 10) {
    let newBatsman = prompt("Enter name of new batsman:");
    if (!newBatsman) newBatsman = `Batsman ${wickets + 1}`;
    batsmen[currentBatsmanIndex] = {name: newBatsman, runs:0, balls:0, fours:0, sixes:0, out:false};
  } else {
    alert("All out!");
  }
  updateDisplay();
  renderScoreboard();
  checkInningsEnd();
  checkTargetReached();
  saveMatchState();
}

function checkOverComplete() {
  if (balls > 0 && balls % 6 === 0) {
    if (isInningsOver()) {
      alert("Overs completed!");
      return;
    }
    let newBowler = prompt("Over completed. Enter new bowler name:");
    if (!newBowler) newBowler = `Bowler ${bowlers.length + 1}`;
    bowlers.push({name: newBowler, balls:0, runs:0, wickets:0});
    currentBowlerIndex = bowlers.length - 1;
  }
}

function isInningsOver() {
  return wickets >= 10 || balls >= totalOvers * 6;
}

function checkInningsEnd() {
  if (isInningsOver()) {
    alert(`Innings over! Total Score: ${score}/${wickets}`);
  }
}

function checkTargetReached() {
  if (inning === 2 && score >= firstInningsScore + 1) {
    alert("Target reached!");
    endMatch();
  }
}

function endMatch() {
  const teamA = document.getElementById("teamA").value.trim();
  const teamB = document.getElementById("teamB").value.trim();
  if (inning === 1) {
    firstInningsScore = score;
    inning = 2;
    score = 0; wickets = 0; balls = 0; extras = 0; legByeCount = 0;
    ballHistory = [];
    batsmen = []; bowlers = [];
    currentBatsmanIndex = 0; currentBowlerIndex = 0;
    let striker = prompt("Enter name of batsman for 2nd Innings:");
    if (!striker) striker = "Batsman 1";
    let bowlerName = prompt("Enter name of opening bowler for 2nd Innings:");
    if (!bowlerName) bowlerName = "Bowler 1";
    batsmen.push({name: striker, runs:0, balls:0, fours:0, sixes:0, out:false});
    bowlers.push({name: bowlerName, balls:0, runs:0, wickets:0});
    document.getElementById("inningLabel").textContent = `(2nd Innings)`;
    document.getElementById("targetInfo").textContent = `Target: ${firstInningsScore + 1} to win`;
    updateDisplay();
    renderScoreboard();
    clearMatchState();
    document.getElementById("summary").classList.add("hidden");
  } else {
    let winnerText = "";
    if (score > firstInningsScore) {
      winnerText = `${teamB} won by ${10 - wickets} wicket(s)!`;
    } else if (score < firstInningsScore) {
      winnerText = `${teamA} won by ${firstInningsScore - score} run(s)!`;
    } else {
      winnerText = "Match tied!";
    }
    const matchSummary = {
      teams: `${teamA} vs ${teamB}`,
      score1: `${firstInningsScore}/10 (max overs)`,
      score2: `${score}/${wickets}`,
      winner: winnerText,
      date: new Date().toLocaleString()
    };
    history.unshift(matchSummary);
    localStorage.setItem('crickHistory', JSON.stringify(history));
    document.getElementById("summary").classList.remove("hidden");
    document.getElementById("winner").textContent = winnerText;

    if (!winnerText.includes("tied")) {
      const winningTeam = score > firstInningsScore ? teamB : teamA;
      const congrats = document.createElement("p");
      congrats.className = "text-2xl text-green-600 font-bold mt-4 animate-bounce-in";
      congrats.textContent = "üéâ Congratulations to " + winningTeam + "!";
      document.getElementById("summary").appendChild(congrats);
      confetti({ particleCount: 200, spread: 90, origin: { y: 0.6 } });
      document.getElementById("victorySound").play();
    }

    const playAgainContainer = document.getElementById("playAgainContainer");
    playAgainContainer.innerHTML = "";
    const playAgainBtn = document.createElement("button");
    playAgainBtn.id = "playAgainBtn";
    playAgainBtn.textContent = "üîÑ Play Again";
    playAgainBtn.className = "btn bg-blue-600 hover:bg-blue-700 mt-2";
    playAgainBtn.onclick = () => location.reload();
    playAgainContainer.appendChild(playAgainBtn);

    disableScoringButtons();
    document.getElementById("matchPanel").classList.add("hidden");
    document.getElementById("scoreboard").classList.add("hidden");
    renderHistory();
  }
}

function disableScoringButtons() {
  const buttons = document.querySelectorAll(
    'button:not(#playAgainBtn):not([onclick="clearHistory()"])'
  );
  buttons.forEach(btn => {
    if (!btn.closest("#history")) btn.disabled = true;
  });
}

function updateDisplay() {
  document.getElementById("score").textContent = `${score}/${wickets}`;
  document.getElementById("overs").textContent = `${Math.floor(balls/6)}.${balls%6}`;
  let runRate = balls > 0 ? (score / (balls/6)) : 0;
  document.getElementById("runRate").textContent = runRate.toFixed(2);
  let oversLeft = totalOvers - Math.floor(balls/6) - ((balls%6)/6);
  document.getElementById("oversLeft").textContent = oversLeft.toFixed(1);
}

function renderScoreboard() {
  const batsmanTable = document.getElementById("batsmanTable");
  batsmanTable.innerHTML = "";
  batsmen.forEach(b => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="border px-2">${b.name}</td>
      <td class="border px-2">${b.runs}</td>
      <td class="border px-2">${b.balls}</td>
      <td class="border px-2">${b.fours}</td>
      <td class="border px-2">${b.sixes}</td>
      <td class="border px-2">${b.out ? "Out" : "Not Out"}</td>
    `;
    batsmanTable.appendChild(tr);
  });

  const bowlerTable = document.getElementById("bowlerTable");
  bowlerTable.innerHTML = "";
  bowlers.forEach(b => {
    const overs = Math.floor(b.balls / 6) + "." + (b.balls % 6);
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="border px-2">${b.name}${b === bowlers[currentBowlerIndex] ? " (current)" : ""}</td>
      <td class="border px-2">${overs}</td>
      <td class="border px-2">${b.runs}</td>
      <td class="border px-2">${b.wickets}</td>
    `;
    bowlerTable.appendChild(tr);
  });
}

function undoLastBall() {
  if (ballHistory.length === 0) return alert("No balls to undo!");
  const lastBall = ballHistory.pop();
  score = lastBall.scoreBefore;
  wickets = lastBall.wicketsBefore;
  balls = lastBall.ballsBefore;
  batsmen = JSON.parse(lastBall.batsmenBefore);
  bowlers = JSON.parse(lastBall.bowlersBefore);
  if (lastBall.type === 'legbye') legByeCount = lastBall.legByeCountBefore;
  currentBatsmanIndex = batsmen.findIndex(b => !b.out);
  currentBowlerIndex = lastBall.bowlerIndex;
  updateDisplay();
  renderScoreboard();
}

function renderHistory() {
  const historyList = document.getElementById("matchHistory");
  historyList.innerHTML = "";
  if (history.length === 0) {
    historyList.innerHTML = "<li>No matches played yet.</li>";
    return;
  }
  history.forEach(match => {
    const li = document.createElement("li");
    li.textContent = `[${match.date}] ${match.teams} - 1st Innings: ${match.score1}, 2nd Innings: ${match.score2} => Winner: ${match.winner}`;
    historyList.appendChild(li);
  });
}

function clearHistory() {
  if (confirm("Are you sure you want to clear match history?")) {
    history = [];
    localStorage.removeItem('crickHistory');
    renderHistory();
  }
}

renderHistory();

  </script>
  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js')
      .then(reg => {
        console.log("‚úÖ Service Worker Registered");

        // Force update if already waiting
        if (reg.waiting) {
          reg.waiting.postMessage({ type: 'SKIP_WAITING' });
          window.location.reload();
        }

        // Detect new installs in future
        reg.addEventListener("updatefound", () => {
          const newSW = reg.installing;
          newSW.addEventListener("statechange", () => {
            if (newSW.state === "installed" && navigator.serviceWorker.controller) {
              newSW.postMessage({ type: 'SKIP_WAITING' });
              window.location.reload();
            }
          });
        });
      })
      .catch(err => console.error("‚ùå Service Worker registration failed", err));
  }
</script>
  
<!-- ‚úÖ Footer must be inside <body> -->
<footer class="text-center text-sm text-gray-500 mt-10">
  Developed by 
  <a href="https://github.com/prem90902304" target="_blank" class="text-blue-600 hover:underline font-semibold">
    ROOM 115
  </a> ‚Ä¢ ¬© 2025 CrickScore
</footer>

</body>
</html>
